function updateCanvasInput(e,a){var t=e?e:parseInt($canvaswrap.width(),10),i=a?a:parseInt($canvaswrap.height(),10);$(".canvassize").html("<b>canvas</b>: "+t+"/"+i+"px"),$("#canvas_w_val").val(t),$("#canvas_h_val").val(i)}function setgridsize(){gridsize=$canvaswrap.attr("snappy"),gridsize>0?($(".grid-size-val").text(gridsize),$("#snap-to-grid").attr("checked",!0),updategrid(gridsize),$("#grid-slider").slider("value",gridsize)):"col"==gridsize?($("#snap-to-grid").attr("checked",!0),$("select#grid-type").val("col"),gridsize=0,updategrid("col")):(updategrid(20),$("#grid-slider").slider("value",20))}function lock(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");e.length&&!$("#canvas .selected.locked").length?(e.addClass("locked , icon-").draggable("destroy").resizable("destroy"),saveState(e)):$("#canvas .selected.locked").length&&($("#canvas .selected.locked").removeClass("locked icon-").unbind("click").data("draggable",!1),$("#lock").removeClass("pressed"),makeDrag(e))}function unlock(e){e.removeClass("locked icon-").unbind("click").data("draggable",!1),$("#lock").removeClass("pressed"),makeDrag(e)}function showSaveButton(){$("#slogan").fadeOut("fast",function(){$(".controls").fadeIn(),$("#links").addClass("linksmin")})}function InstantShowSaveButton(){$("#slogan").hide(),$("#links").addClass("linksmin"),$("#demo").hide(),$(".controls").show()}function edittext(e){if(!previewMode){e.stopPropagation(),supercanvas.boxer("destroy");var a=$canvas.find(".selected .textme");saveState(a.closest(".wire")),a.parent().parent().parent().removeClass("selected").css("z-index",99999999);var t=a.html().replace(/<br>/gi,"\n"),i=$("<textarea class='editingtext' tabindex='-1' ></textarea>");i.val($("<div />").html(t).text()),a.replaceWith(i),i.focus(),i.bind("blur",textblur),i.autoResize()}}function focustext(){$(".latest .editingtext").focus()}function textblur(){previewMode||useboxer();var e=$canvas.find(".editingtext"),a=e.css("height");e.parent().parent().parent().css("z-index","auto");var t=e.val().replace(/\n/gi,"<br>"),i=$("<div>");""===t&&(t="..."),i.html(t).addClass("textme"),e.replaceWith(i),i.closest(".wire").css({height:a,position:"absolute"}),i.closest(".wirejr").draggable("destroy"),$("textarea.editingtext").remove()}function divClicked(e){supercanvas.boxer("destroy"),$(this).parent().addClass("latest");var a=$(this).html().replace(/<br>/gi,"\n"),t=$("<textarea class='editingtext'/>");t.val($("<div />").html(a).text()).addClass("textareanow"),$(this).replaceWith(t),t.focus(),t.blur(editableTextBlurred),$(".latest .ok").show(),$("textarea").autoResize(),$(".annotbox").addClass("textareainside"),$(".ok").click(editableTextBlurred)}function editableTextBlurred(){previewMode||useboxer(),$t=$(".textareanow"),$t.parent().removeClass("latest");var e=$t.val().replace(/\n/gi,"<br>"),a=$("<div>");""===e&&(e="..."),a.html(e).insertBefore($t).click(divClicked),$t.remove(),$(".ok").hide(),previewMode&&(saveComment(),a.parent().parent().draggable({cancel:".annotbox , .closeannot",cursor:"move"}).resizable({handles:"all"}))}function selectColliders(e){var a={},t=activepage.find(".selecting");a.top=e.box.position().top-Number(t.height()),a.left=e.box.position().left-Number(t.width()),a.right=e.box.position().left,a.bottom=e.box.position().top;$();activepage.find(".wire").not(".brandnew, .locked, .groupmember").each(function(){var e={};e.top=$(this).position().top,e.left=$(this).position().left,e.right=Number($(this).position().left)+Number($(this).width()),e.bottom=Number($(this).position().top)+Number($(this).height()),a.right>=e.right&&a.left<=e.left&&a.top<=e.top&&a.bottom>=e.bottom&&$(this).addClass("selected")})}function useboxer(){supercanvas.boxer({cursor:"pointer",stop:function(e,a){if($(".brandnew").hasClass("selecting"))selectColliders(a),$canvas.find(".selected.locked").length&&0===$canvas.find(".selected:not(.locked)").length&&$("#lock").addClass("pressed"),$canvas.find(".selected.grouped").length&&0===$canvas.find(".selected:not(.grouped)").length&&$("#group").addClass("pressed"),$("#canvas .brandnew").remove();else{var t=(a.box.height(),a.box.width());if(a.box.width()>20||a.box.height()>20){$("#icons").show().siblings().hide(),aspect_ratio($("#canvas .blank")),$("#annotate").show(),$("#textinput").removeClass("lasticon");var i=a.box.position(),s=i.top,n=i.left,o=$("#canvas-wrap").position(),r=s+o.top-40,d=wirepanel.width(),l=n+t/2-d/2+o.left;0>=l&&(l=0),wirepanel.css({top:r,left:l}),wirepanel.show()}else a.box.remove()}}})}function prepareWire(){var e=$(".brandnew"),a=e.height();if(e.removeAttr("class").addClass("wirejr brandnew blank latestwire").empty().css({background:defbgcolor,width:clonewidth-2*defbw+1,height:cloneheight-2*defbw+1,"border-width":defbw+"px","border-color":defstrcolor,color:defstrcolor}),e.addClass("new").addClass(type).css("margin-top",0),"annotate"==type&&$(".brandnew.annotate").removeClass("wire").addClass("aa").append(annotationhtml).draggable({cancel:".annotbox , .closeannot",cursor:"move"}),("slider2"==type||"line_hor"==type)&&e.addClass("resizeX"),"slider"==type&&e.css("margin-top",a/2-3).removeClass("slider").addClass("slider2").append("<span>").find("span").css("background",defstrcolor),"line_hor"==type&&e.css("margin-top",a/2),"scrollh"==type&&e.css("margin-top",a/2-10),"paragraph"==type&&e.append(paragraph).find("span").css("background",defstrcolor),"textinput"==type&&e.removeClass("textinput").addClass("textinput2").append("<span>|</span>"),"combobox"==type&&e.removeClass("combobox").addClass("combobox2").append("<span>&#9660;</span>"),"scrollh"==type&&e.removeClass("scrollh").addClass("scrollh2").append("<span class='arrL'>&#9664;</span>").append("<span >&#9654;</span>"),"progressbar"==type&&e.removeClass("progressbar").addClass("progressbar2").append("<span></span>"),"list"==type&&e.append(list).find("span").css("background",defstrcolor),"headlinetxt"==type&&e.addClass("lastheadline textnew text-arimo").append(texthtml),e.hasClass("headline")&&$(".brandnew.headline").html(headtxt).find(".headtext span").css("background",defstrcolor),e.hasClass("image")){e.svg();var t=e.width(),i=e.height(),s=e.svg("get");s.line(0,i,t,0,{"class":"line1",stroke:defstrcolor,strokeWidth:defbw}),s.line(0,0,t,i,{"class":"line2",stroke:defstrcolor,strokeWidth:defbw}),e.addClass("hasSVG")}}function insertWire(){if($(".brandnew").length){if("annotate"!==type){var e=$(".brandnew");e.wrap("<div class='wire'></div>");var a=e.closest(".wire"),t=e.width(),i=e.height(),s=e.position(),n=s.top,o=s.left,r=parseInt(e.css("zIndex"),10),d="w"+(new Date).getTime();saveState("",[d]),a.css({top:n,left:o,width:t+2*defbw,height:i+2*defbw}).attr("id",d),e.css("cssText","border-width:"+defbw+"px;border-color:"+defstrcolor+";color:"+defstrcolor+";background:"+defbgcolor+";z-index:"+r+";"),e.is(".aa")&&e.css("z-index","5000").removeClass("wirejr"),makeDrag(a)}else makeDrag($(".brandnew")),$(".brandnew").removeClass("wirejr").css("z-index",5e3);if("headlinetxt"==type&&($(".brandnew").parent().addClass("hastext selected"),$(".textme.thelatest").trigger("editThisText"),$(".textnew.lastheadline").removeClass("lastheadline")),"annotate"==type&&($(".editme").click(divClicked),$(".thelatest").click(),$(".closeannot").click(function(){var e=$(this).parent();e.remove()})),$(".brandnew").removeClass("blank brandnew"),wirePresent){var l=$canvas.find(".wire").length;l>0&&(showSaveButton(),wirePresent=!1)}wirepanel.hide()}}function makeDrag(e){e.filter(".locked").data("draggable",!0).click(function(e){var a=$(this);0!=$("#canvas .brandnew").length||0!==$("#canvas .selected:not(.locked)").length||a.hasClass(".selected")||(a.addClass("selected"),$("#lock").addClass("pressed")),(event.ctrlKey||event.shiftKey||event.metaKey)&&(a.toggleClass("selected"),$canvas.find(".selected.locked").length||$("#lock").removeClass("pressed"))});var a,t,i,s,n,o,r,d,l=!1;e.not(".groupmember , .wirejr , .locked").draggable({snap:".col ",helper:function(e){var a=activepage.find(".wire.selected").not(".locked");if(a.length>1&&$(this).hasClass("selected")){l=!0,a.addClass("multidrag").resizable("destroy"),t=1e5,i=1e5,s=-1,n=-1,a.each(function(){var e=$(this).position(),a=$(this).width(),o=$(this).height();t=t<e.top?t:e.top,i=i<e.left?i:e.left,s=s>e.left+a?s:e.left+a,n=n>e.top+o?n:e.top+o});var o=$("<div/>").css("box-shadow","0 0 0 1px red inset"),r=$("<div/>").css({top:-t,left:-i,width:s-i,height:n-t,position:"relative"}).appendTo(o);return a.clone().resizable("destroy").removeClass("selected").appendTo(r),a.addClass("draggable-original"),o}return $(this)},start:function(e,s){var n=$(this);if($canvaswrap.find(".brandnew").remove(),n.hasClass("selected")?saveState():saveState(n),c=parseInt($(this).css("borderLeftWidth"),10),$(".selected.locked").removeClass("selected"),s.helper.data("draggableXY.originalPosition",s.position||{top:0,left:0}),s.helper.data("draggableXY.newDrag",!0),a=$("#canvas .selected:not(.locked)"),l&&(o=n.position().top,r=n.position().left,s.helper.css({"margin-top":t-o,"margin-left":i-r}),startPos={top:t,left:i},1!=e.altKey?a.addClass("transparent"):a.removeClass("selected")),(!e.shiftKey&&$("#canvas .selected:not(.locked)").length<2||!n.hasClass("selected"))&&$(".selected").removeClass("selected"),$dim.html("<b>W</b>: "+($(this).outerWidth()-1)+"px, <b>H</b>: "+($(this).outerHeight()-1)+"px"),wirepanel.hide(),a.children().removeClass("selected"),posTopArray=[],posLeftArray=[],0==gridsize&&"col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked"))if(multipaged){var p=$canvas.add(activepage.find(".wire").not(this).not(".multidrag , .groupmember")).add($canvaswrap.find("#gridcol .col"));guides=$.map(p,computeGuidesForElement)}else{var p=$canvas.add($canvaswrap.find(".wire").not(this).not(".multidrag")).add($canvaswrap.find("#gridcol .col"));guides=$.map(p,computeGuidesForElement)}else if(0==gridsize)if(multipaged){var p=$canvas.add(activepage.find(".wire").not(this).not(".multidrag , .groupmember"));guides=$.map(p,computeGuidesForElement)}else{var p=$canvas.add($canvaswrap.find(".wire").not(this).not(".multidrag"));guides=$.map(p,computeGuidesForElement)}d={top:parseInt(s.helper.css("margin-top"),10),left:parseInt(s.helper.css("margin-left"),10)},innerOffsetX=e.pageX-this.offsetLeft,innerOffsetY=e.pageY-this.offsetTop},drag:function(e,a){if(e.shiftKey){var t=a.helper.data("draggableXY.originalPosition"),i=Math.abs(t.left-a.position.left),s=Math.abs(t.top-a.position.top),n=a.helper.data("draggableXY.newDrag");a.helper.data("draggableXY.newDrag",!1);var o=n?Math.max(i,s)===i:a.helper.data("draggableXY.xMax");a.helper.data("draggableXY.xMax",o);{a.position}o&&$(this).draggable("option","axis","x"),o||$(this).draggable("option","axis","y")}if(0==gridsize){var r,l,c,p,h,g=MIN_DISTANCE+1,v=MIN_DISTANCE+1,u=a.helper,f=u.outerWidth()-1,m=u.outerHeight()-1;$.each(guides,function(e,t){"h"==t.type&&((h=Math.abs(a.position.top+d.top-t.y))<v&&(v=h,l=t,p=0),(h=Math.abs(a.position.top+d.top-t.y+m))<v&&(v=h,l=t,p=m)),"v"==t.type&&((h=Math.abs(a.position.left+d.left-t.x))<g&&(g=h,r=t,c=0),(h=Math.abs(a.position.left+d.left-t.x+f))<g&&(g=h,r=t,c=f))}),(!e.shiftKey||e.shiftKey&&!o)&&(MIN_DISTANCE>=v?($("#guide-h").css("top",l.y).show(),a.position.top=l.y-p-d.top):($("#guide-h").hide(),a.position.top+=1)),(!e.shiftKey||e.shiftKey&&o)&&(MIN_DISTANCE>=g?($("#guide-v").css("left",r.x).show(),a.position.left=r.x-c-d.left):($("#guide-v").hide(),a.position.left+=1))}if(gridsize>0){var b=a.position.left,w=a.position.top,f=$(this).outerWidth()-1,m=$(this).outerHeight()-1,x=a.position.left+f,k=a.position.top+m;snappedleft=Math.round(b/gridsize)*gridsize,snappedright=Math.round(x/gridsize)*gridsize,snappedtop=Math.round(w/gridsize)*gridsize,snappedbottom=Math.round(k/gridsize)*gridsize;var C=Math.abs(snappedleft-a.position.left),y=Math.abs(snappedright-a.position.left-f),z=Math.abs(snappedtop-a.position.top),_=Math.abs(snappedbottom-a.position.top-m);a.position.left=y>C?snappedleft:snappedright-f,a.position.top=_>z?snappedtop:snappedbottom-m}},stop:function(e,a){$("#guide-v, #guide-h").hide();var s=$(this);if(activepage.data("altdrag")||activepage.find(".selected").length||s.addClass("selected"),l){draggingInProgress=!1,activepage.find("div.transparent").remove();var n=a.helper.clone().find(".dimT , .dimL").remove().end().find("> div > .wire"),o=(n.first().parent().parent(),a.helper.position().left+parseInt(a.helper.css("margin-left"))-i),r=a.helper.position().top+parseInt(a.helper.css("margin-top"))-t;n.find(".ui-resizable-handle").remove(),$toApp=$();var d=[];n.each(function(e){$(this).is(".groupmember")&&n.unwrap().unwrap();var a=$(this);abspos={top:parseInt(a.css("top")),left:parseInt(a.css("left"))};var t="w"+(new Date).getTime()+e;a.css({top:abspos.top+r,left:abspos.left+o}),activepage.data("altdrag")&&(a.attr("id",t),d[e]=t),$toApp=$toApp.add(a)}),activepage.find(".draggable-original").removeClass("draggable-original").draggable("destroy"),$toApp.addClass("selected").removeData("draggable").appendTo(activepage),activepage.find(".multidrag").removeClass("multidrag"),makeDrag($toApp),l=!1,activepage.data("altdrag")&&(activepage.data("altdrag",!1),historystate.shift(),saveState("",d))}$(this).hasClass("altdrag")?$(".altdrag").removeClass("selected altdrag"):$(this).addClass("selected"),$(this).draggable("option","axis","none")}});var c=2;e.not(".groupmember , .wirejr , .locked").resizable({autoHide:!0,start:function(e,a){if(multipaged)var t=$("#canvas .page:visible .selected");else var t=$("#canvas .selected");$("#guide-v , #guide-h").hide(),handle=$(this).data("resizable").axis,saveState($(this)),c=parseInt(t.css("borderLeftWidth"),10),wirepanel.hide(),$(this).removeClass("selected"),0==gridsize&&"col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked")?guides=multipaged?$.map($(" #canvas .page:visible .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas , #gridcol .col").not(this),computeGuidesForElement):0==gridsize&&(guides=multipaged?$.map($("#canvas .page:visible .wire, #canvas").not(this),computeGuidesForElement):$.map($("#canvas .wire, #canvas").not(this),computeGuidesForElement))},resize:function(e,a){if(0==gridsize){var t,i,s,n,o,r=MIN_DISTANCE+1,d=MIN_DISTANCE+1,l={top:a.position.top,left:a.position.left},p=a.size.width-1,h=a.size.height-1;$.each(guides,function(e,a){"h"==a.type&&((o=l.top-a.y)<d&&(o=l.top-a.y)>-1*d&&"s"!==handle&&"se"!==handle&&"sw"!==handle&&(d=o,i=a,n=0),(o=l.top-a.y+h)<d&&(o=l.top-a.y+h)>-1*d&&"n"!==handle&&"ne"!==handle&&"nw"!==handle&&(d=o,i=a,n=h)),"v"==a.type&&((o=l.left-a.x)<r&&(o=l.left-a.x)>-1*r&&"e"!==handle&&"ne"!==handle&&"se"!==handle&&(r=o,t=a,s=0),(o=l.left-a.x+p)<r&&(o=l.left-a.x+p)>-1*r&&"w"!==handle&&"nw"!==handle&&"sw"!==handle&&(r=o,t=a,s=p))}),MIN_DISTANCE>=d&&("n"==handle||"ne"==handle||"nw"==handle)?($("#guide-h").css("top",i.y).show(),a.position.top=i.y-n,a.size.height+=d):MIN_DISTANCE>=d&&("s"==handle||"sw"==handle||"se"==handle)?($("#guide-h").css("top",i.y).show(),a.size.height-=d+2*c):MIN_DISTANCE>=r&&("w"==handle||"sw"==handle||"nw"==handle)?($("#guide-v").css("left",t.x).show(),a.position.left=t.x-s,a.size.width+=r+1):MIN_DISTANCE>=r&&("e"==handle||"se"==handle||"ne"==handle)?($("#guide-v").css("left",t.x).show(),a.size.width-=r+2*c):$("#guide-v , #guide-h").hide()}if($(".ui-resizable-resizing").hasClass("svginside")){var g=a.size.width;$(".ui-resizable-resizing svg ").css("width",g);var v=a.size.height;$(".ui-resizable-resizing svg ").css("height",v)}if($(".ui-resizable-resizing").has("hasSVG")){var g=$(".ui-resizable-resizing").width(),v=$(".ui-resizable-resizing").height(),u=$(".ui-resizable-resizing .line2").attr("stroke-width");$(".ui-resizable-resizing .line1").attr("x2",g-2*u),$(".ui-resizable-resizing .line1").attr("y1",v-2*u),$(".ui-resizable-resizing .line2").attr("x2",g-2*u),$(".ui-resizable-resizing .line2").attr("y2",v-2*u),$(".ui-resizable-resizing svg").attr("height",v-2*u),$(".ui-resizable-resizing svg").attr("width",g-2*u)}if(gridsize>0){var f=a.position.left,m=a.position.top,p=a.size.width-1,h=a.size.height-1,b=a.position.left+p,w=a.position.top+h;snappedleft=Math.round(f/gridsize)*gridsize,snappedright=Math.round(b/gridsize)*gridsize,snappedtop=Math.round(m/gridsize)*gridsize,snappedbottom=Math.round(w/gridsize)*gridsize;{Math.abs(snappedleft-a.position.left),Math.abs(snappedright-a.position.left-p),Math.abs(snappedtop-a.position.top),Math.abs(snappedbottom-a.position.top-h)}"se"==handle&&(a.size.width=snappedright-f-2*c+1,a.size.height=snappedbottom-m-2*c+1),"e"==handle&&(a.size.width=snappedright-f-2*c+1),"s"==handle&&(a.size.height=snappedbottom-m-2*c+1),"w"==handle&&(a.size.width=b-snappedleft-2*c+1,a.position.left=snappedleft),"n"==handle&&(a.size.height=w-snappedtop-2*c+1,a.position.top=snappedtop),"nw"==handle&&(a.size.height=w-snappedtop-2*c+1,a.position.top=snappedtop,a.size.width=b-snappedleft-2*c+1,a.position.left=snappedleft),"ne"==handle&&(a.size.height=w-snappedtop-2*c+1,a.position.top=snappedtop,a.size.width=snappedright-f-2*c+1),"sw"==handle&&(a.size.width=b-snappedleft-2*c+1,a.position.left=snappedleft,a.size.height=snappedbottom-m-2*c+1)}if($dim.html("<b>W</b>: "+(a.size.width+2*c-1)+"px, <b>H</b>: "+(a.size.height+2*c-1)+"px"),$(this).has(".textnew").length){var x=$(this).find(".textnew");a.size.height=x.height(),x.css("width",a.size.width)}},stop:function(e,a){if($("#guide-v , #guide-h").hide(),$(this).addClass("selected"),$(".ui-resizable-resizing").hasClass("svginside")){var t=a.size.width;$(".ui-resizable-resizing svg ").css("width",t);var i=a.size.height;$(".ui-resizable-resizing svg ").css("height",i)}},snap:" .col ",handles:"all"}),e.each(function(){$(this).has(".textnew").length&&$(this).find(".ui-resizable-ne, .ui-resizable-nw, .ui-resizable-sw, .ui-resizable-se, .ui-resizable-n, .ui-resizable-s").remove()}),$(".grouped").length&&$(".grouped").resizable("destroy")}function MakeCanvasDrag(){$("#canvas-wrap").resizable({minWidth:320,minHeight:320,start:function(e,a){wirepanel.hide();var t=$("#canvas").height();$("#canvas").css("width",cwidth+2),$("#canvas").css("height",t+2)},resize:function(e,a){cwidth=a.size.width,$(".canvassize").html("<b>canvas</b>: "+parseInt(a.size.width,10)+"/"+parseInt(a.size.height,10)+"px"),$(".canvassize").html("<b>canvas</b>: "+$("#canvas").width()+"/"+$("#canvas").height()+"px"),$("#canvas").css("width","100%"),$("#canvas").css("height","100%")},stop:function(e,a){$(".container").css("height","auto"),supercanvas.css("height","100%"),cwidth=a.size.width,$canvaswrap.hasClass("mobile-landscape")&&(cwidth=480),$(this).center(),activepage.attr({"data-page-width":a.size.width,"data-page-height":a.size.height}),updateCanvasInput()},alsoResize:".container",handles:"se"}).draggable({handle:"#browser",cursor:"move",containment:".container",stop:function(e){parseInt($(this).css("top"),10)<80&&$(this).transition({top:"110px"}),offset_c=$("#canvas").offset()}}),$canvaswrap.find(".ui-resizable-se").addClass("icon-resize-full")}function delnow(){var e=$canvas.find(".selected").not(".locked");saveState(e),e.remove()}function positionwirepanel(){offset_c=$("#canvas-wrap").position();var e=$("#canvas div.selected"),a=(e.height(),e.width()),t=e.position(),i=t.top,s=t.left,n=i+offset_c.top-45,o=wirepanel.width(),r=s+a/2-o/2+offset_c.left;0>=r&&(r=0),wirepanel.css({top:n,left:r}).show()}function editme(e){var a=e;return a.is(".locked")?!1:void(a.length&&!a.is(".grouped")&&(render_edit_menu(),positionwirepanel()))}function copynow(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");e.addClass("copying").resizable("destroy").draggable("destroy");var a="";e.each(function(e){a+=$(this).outerHTML()});var t={data:a,parent:activepage.attr("id")};localStorage.setItem("clipboard",JSON.stringify(t)),e.removeClass("selected , copying"),pasteIndex=1}function cutnow(){if(multipaged)var e=$("#canvas .page:visible .selected");else var e=$("#canvas .selected");saveState(),e.addClass("copying").resizable("destroy").draggable("destroy");var a="";e.each(function(e){a+=$(this).outerHTML()}),localStorage.setItem("clipboard",a),$(".selected").remove(),$(".copied").fadeIn().delay(600).fadeOut(),pasteIndex=1}function paste(){$canvas.find(".selected").removeClass("selected");var e=JSON.parse(localStorage.getItem("clipboard")),a=$("<div/>").html(e.data).contents(),t=[],i=1;activepage.find(".wirejr , .grouped").not(".aa, .groupmember").each(function(){var e=parseInt($(this).css("zIndex"),10);e>i&&(i=e)}),a.sort(function(e,a){return e=parseInt($(e).find(".wirejr").not(".groupmember").css("zIndex"),10),a=parseInt($(a).find(".wirejr").not(".groupmember").css("zIndex"),10),e-a});var s=activepage.attr("id")==e.parent;a.each(function(e){var a="w"+(new Date).getTime()+e;t[e]=a;var n=$(this),o={top:parseInt(n.css("top")),left:parseInt(n.css("left"))};n.attr("id",a).removeClass("copying"),n.is(".grouped")?n.css({"z-index":i+pasteIndex+e}):n.find(".wirejr").not(".groupmember .wirejr").css({"z-index":i+pasteIndex+e}),s&&n.css(gridsize>0?{top:Math.round((o.top+gridsize*pasteIndex)/gridsize)*gridsize+"px",left:Math.round((o.left+gridsize*pasteIndex)/gridsize)*gridsize+"px"}:{top:o.top+10*pasteIndex+"px",left:o.left+10*pasteIndex+"px"}),n.is(".grouped")&&$.each(n.find(".wire.groupmember"),function(e){var a="w"+(new Date).getTime()+e;$(this).attr("id",a)})}),activepage.append(a),makeDrag(a),saveState("",t),pasteIndex+=1}function changeBorderWidth(e){if(saveState(),$(".selected").has(".wirejr").length)var a=activepage.find(".selected").not(".locked").find(".wirejr");else var a=$canvas.find(".selected").not(".locked");a.css("box-sizing","content-box");var t=parseInt(a.css("borderLeftWidth"),10),i=e,s=a.width()-2*parseInt(i,10)+2*t,n=a.height()-2*parseInt(i,10)+2*t;a.css({width:s+"px",height:n+"px","border-width":e}),a.css({width:s+"px",height:n+"px","border-width":i+"px"}),a.hasClass("svginside")&&$(".selected svg *").css("stroke-width",i),a.hasClass("hasSVG")&&($(".selected svg line").attr("stroke-width",i),$(".selected svg .line1").attr({y1:n,x2:s}),$(".selected svg .line2").attr({y2:n,x2:s}),$(".selected svg").attr({height:n,width:s})),$dim.html("<b>W</b>: "+(a.outerWidth()-1)+"px, <b>H</b>: "+(a.outerWidth()-1)+"px")}function changeBackgroundColor(e){saveState();var a=e;if($(".selected").has(".wirejr").length)var t=activepage.find(".selected").not(".locked").find(".wirejr");else var t=$canvas.find(".selected").not(".locked");t&&(t.css("background-color",a),t.hasClass("headline")&&t.find("span").css("background-color",a),t.hasClass("headlinetxt")&&t.find("span").css("color",a),t.hasClass("paragraph")&&t.find("span").css("background-color",a),t.hasClass("list")&&(t.find("span").css({"background-color":a,color:a}),t.attr("data-color",a))),t.hasClass("svginside")&&$(".selected .image *").css("background-color",a)}function changeBorderColor(e){if(saveState(),$(".selected").has(".wirejr").length)var a=activepage.find(".selected").not(".locked").find(".wirejr");else var a=$canvas.find(".selected").not(".locked");current_brcolor=e,a.css("border-color",current_brcolor),a.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),a.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}function bring_to_front(){var e=activepage.find(".selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)}),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");e.css("z-index",index_highest+1)})}function send_to_back(){var e=activepage.find(".selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);$(this).css("z-index",e+1)}),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");e.css("z-index",1)})}function send_backward(){var e=activepage.find(".selected").not(".locked");saveState(e),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");var a=parseInt(e.css("zIndex"),10);a=0>=a?1:a,e.css("z-index",a-1)})}function bring_forward(){var e=activepage.find(".selected").not(".locked");saveState(e),e.each(function(){if($(this).is(".grouped"))var e=$(this);else var e=$(this).find(".wirejr");var a=parseInt(e.css("zIndex"),10);e.css("z-index",a+1)})}function computeGuidesForElement(e){var a=$(e);if(a.is(".col")){var t=a.position();ww=$("#canvas").width(),t.left+=.01*ww}else var t=a.position();if(a.is(".col"))var i=a.width(),s=a.height()-1;else var i=a.outerWidth()-1,s=a.outerHeight()-1;return[{type:"h",x:Math.round(t.left),y:Math.round(t.top)},{type:"h",x:Math.round(t.left),y:Math.round(t.top)+s},{type:"v",x:Math.round(t.left),y:Math.round(t.top)},{type:"v",x:Math.round(t.left)+i,y:Math.round(t.top)}]}function computeColForElement(e){var a=$(e),t=a.position();ww=$canvas.width(),t.left+=.01*ww;var i=a.width();return[Math.round(t.left+1),Math.round(t.left+i)]}function aspect_ratio(e){var a=e.width(),t=e.height(),i=a/t;i>=.3&&4>=i&&($(".icon.rect").show(),$(".icon:not(.rect)").hide()),.3>i&&($(".icon.vertical").show(),$(".icon:not(.vertical)").hide()),i>4&&($(".icon.horizontal").show(),$(".icon:not(.horizontal)").hide()),$("#annotate").hide(),$("#textinput").addClass("lasticon")}function render_edit_menu(){$("#icons").hide().siblings().not("#lock , #unlock , #linklist").show(),$("#linklist").hide();var e=$("#canvas div.selected");if(e.has(".wirejr").length)var a=e.find(".wirejr");else var a=e;$showbg.hide(),a.hasClass("paragraph")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.hide()),a.hasClass("list")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$("#textsize").show(),$("#textalign").hide(),$edittxt.hide()),a.hasClass("headlinetxt")||a.hasClass("paragraph")||a.hasClass("list")||($edittxt.hide(),$("#show-border").show(),$("#brind-back-front").show(),$colorpickers.show(),$bordercolors.hide(),$strokes.show(),$textalsz.hide()),(a.hasClass("headlinetxt")||a.hasClass("headline"))&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.show())}function getRandomNumber(e){return Math.floor(Math.random()*e)}function getRandomChar(){var e="0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ";return e.substr(getRandomNumber(62),1)}function randomID(e){for(var a="",t=0;e>t;t++)a+=getRandomChar();return a}function demo0(){$("#canvas").append("<div id='demo'><div class='demoinfo'>Click & drag to draw</div><div id='demobox' ></div><div id='democursor'><i class='icon-cursor'></i></div><div id='demopanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div id='demoeditpanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>"),$("#demobox").css({width:"0",height:"0"}).removeAttr("class"),$(".demoinfo").text("Click & drag to draw"),$("#demo").fadeIn("slow",demo1)}function demo1(){$("#democursor").animate({top:"40px",left:"20px"},1500,demo1a)}function demo1a(){$("#democursor").addClass("drag"),demo2()}function demo2(){$("#demobox").delay(500).animate({width:"240px",height:"160px"},3500),$("#democursor").delay(500).animate({top:"200px",left:"260px"},3500,demo3)}function demo3(){$("#democursor").removeClass("drag"),$("#demopanel").delay(500).show(0,demo4)}function demo4(){$(".demoinfo").text("Select stencil"),$("#democursor").delay(800).animate({top:"125px",left:"55px"},1500,demo5)}function demo4a(){demo5()}function demo5(){$("#demobox").addClass("demobox"),$("#democursor").delay(800).animate({top:"125px",left:"80px"},500,demo5a)}function demo5a(){$("#demobox").addClass("round"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5b)}function demo5b(){$("#demobox").addClass("demoround"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5c)}function demo5c(){$("#democursor").addClass("drag"),demo5d()}function demo5d(){$("#demopanel").delay(300).hide(0,demo5e)}function demo5e(){$("#democursor").removeClass("drag"),demo6()}function demo6(){$("#demopanel").delay(1500).hide(0,demo6a)}function demo6a(){$(".demoinfo").text("Doubleclick to edit"),$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6b)}function demo6b(){$("#democursor").removeClass("drag"),demo6c()}function demo6c(){$("#demopanel").delay(200).hide(0,demo6d)}function demo6d(){$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6e)}function demo6e(){$("#democursor").removeClass("drag"),$("#demoeditpanel").delay(400).show(0,demo7)}function demo7(){$("#democursor").delay(800).animate({top:"125px",left:"178px"},500,demo7a)}function demo7a(){$("#demopanel").delay(500).hide(0,demo7b)}function demo7b(){$("#democursor").addClass("drag"),$("#demobox").addClass("grey"),demo7c()}function demo7c(){$("#demoeditpanel").delay(300).hide(0,demo7d)}function demo7d(){$("#democursor").removeClass("drag"),demo8()}function demo8(){$("#demo").delay(1600).hide("slow")}function updategrid(e){for(var a=0;5>a;a++){var t="#grid-pattern .lineV:eq("+[a]+")",i="#grid-pattern .lineH:eq("+[a]+")";$(i).attr({y1:[a+1]*e,y2:[a+1]*e,x2:5*e}),$(t).attr({x1:[a+1]*e,x2:[a+1]*e,y2:5*e}),$(".svgdot").attr({cx:e-.5,cy:e-.5})}$("#grid-pattern").attr({width:5*e,height:5*e}),$("#dot-pattern").attr({width:e,height:e})}function turngridon(){$("#snap-to-grid").attr("checked")&&("graph"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr("snappy",gridsize)):"dots"==$("select#grid-type").val()?(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr("snappy",gridsize)):"col"==$("select#grid-type").val()&&($canvaswrap.attr("snappy","col"),gridsize=0))}function getDeletedGroupData(e){var a=[];return $.each(e,function(e){var t=$(this);a[e]={html:t.find("div").first().outerHTML(),css:{top:t.css("top"),left:t.css("left"),width:t.css("width"),height:t.css("height")},id:t.attr("id"),orgclass:t.attr("class"),parent:t.parent().attr("id")}}),a}function saveState(e,a,t,i,s){var n=[];if("undefined"==typeof e)var e=$canvas.find(".selected");if(a?n={deleteid:a}:$.each(e,function(e){var a=$(this),t=a.getId();n[e]={html:a.find("div").first().outerHTML(),css:{top:a.css("top"),left:a.css("left"),width:a.css("width"),height:a.css("height"),"z-index":a.css("zIndex")},id:t,orgclass:a.attr("class"),parent:a.parent().attr("id"),unlock:a.hasClass("locked")}}),s)for(var o in s)n[o]=s[o];var r;t?r=future:(r=historystate,i||(future=[],$("#redo").removeClass("inactive"))),r.unshift(n),r.length>10&&r.pop(),$("#undo").hasClass("inactive")&&$("#undo").removeClass("inactive")}function restoreState(e){var a;if(a=e?historystate:future,a.length>0){var t=a[0],i=$();if(t.deleteid&&deletePasted(t,e),t.hasOwnProperty("0")){delete t.deleteid,$.each(t,function(e){i=i.add($("#"+t[e].id))}),$("#"+t[0].id).length&&saveState(i,!1,e,!0);var s=!1,n=[];$.each(t,function(e){return t[e].unlock?void unlock($("#"+t[e].id)):void($("#"+t[e].id).length&&!$("#"+t[e].id).is(".groupmember")?$("#"+t[e].id).resizable("destroy").draggable("destroy").css(t[e].css).html(t[e].html):($("<div/>").appendTo($("#"+t[e].parent)).addClass(t[e].orgclass).removeClass("ui-draggable ui-resizable ui-resizable-autohide").html(t[e].html).attr("id",t[e].id).css(t[e].css),i=i.add($("#"+t[e].id)),n[e]=t[e].id,s=!0))}),s&&saveState("",n,e,!0),makeDrag(i)}a.shift(),$("#redo").hasClass("inactive")&&$("#redo").removeClass("inactive"),e||a.length||($("#redo").addClass("inactive"),$("#undo").removeClass("inactive")),e&&!a.length&&$("#undo").addClass("inactive")}else $("#undo").addClass("inactive")}function deletePasted(e,a){var t=$();$.each(e.deleteid,function(e){$("#"+this).is(".grouped")?ungroup_elements($("#"+this)):t=t.add($("#"+this));

}),saveState(t,!1,a),t.remove()}function makeDragNow(){historystate.shift(),activepage=$(multipaged?".page:visible":"#canvas"),useboxer(),$("#canvas").mousemove(function(e){$(".coord").html("<b>X</b>: "+parseInt(e.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(e.pageY-offset_c.top,10))})}function saveUndo(){future.length>4&&future.pop()}function handleKeys(e){if(!$ajaxlogin.is(":visible")&&!activepage.find("textarea.editingtext").length)switch($canvas.find(".locked.selected").removeClass("selected"),draggable=$canvas.find(".selected"),distance=1,gridsize>0&&(distance=parseInt(gridsize,10)),pTopArray=[],pLeftArray=[],37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode||e.ctrlKey||(saveState(),draggable.each(function(e){thiscsstop=$(this).css("top"),thiscssleft=$(this).css("left"),pTopArray[e]=parseInt(thiscsstop,10),pLeftArray[e]=parseInt(thiscssleft,10)})),e.preventDefault(),e.keyCode){case 37:draggable.each(function(e){$(this).css("left",pLeftArray[e]-distance)});break;case 38:draggable.each(function(e){$(this).css("top",pTopArray[e]-distance)});break;case 39:draggable.each(function(e){$(this).css("left",pLeftArray[e]+distance)});break;case 40:draggable.each(function(e){$(this).css("top",pTopArray[e]+distance)});break;default:return!0}}function group_ungroup(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");1===e.length&&e.is(".grouped")?ungroup_elements(e):group_elements(e)}function group_elements(e){if(e.length>1){var a=1e4,t=1e4,i=-1,s=-1;e.each(function(){var e=$(this).position(),n=$(this).width(),o=$(this).height();a=a<e.top?a:e.top,t=t<e.left?t:e.left,i=i>e.left+n?i:e.left+n,s=s>e.top+o?s:e.top+o}),activepage.find("> .wire > .wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10)||0;index_highest=1|index_highest,e>index_highest&&(index_highest=e)});var n=Math.floor(99999*Math.random());e.draggable("destroy").resizable("destroy").css({position:"absolute"}).removeClass("selected").addClass("groupmember"),e.wrapAll('<div  style="position:relative; top:-'+a+"px; left:-"+t+'px;"/>'),e.parent().wrap('<div class="grouped wire" id='+n+' style="position:absolute;top:'+a+"px; left:"+t+"px;width:"+(i-t+2)+"px;height:"+(s-a+2)+"px;z-index:"+(index_highest+1)+'"/>'),e.parent().parent().addClass("selected"),saveState("",[n]),$("#group").addClass("pressed")}}function ungroup_elements(e){e.draggable("destroy").resizable("destroy");var a=[],t=[];a=getDeletedGroupData(e),e.each(function(e){var a=$(this),i=a.find("> div > .wire").clone();i=i.sort(function(e,a){if($(e).is(".grouped"))var t=parseInt($(e).css("zIndex"));else var t=parseInt($(e).find(".wirejr").css("zIndex"));if($(a).is(".grouped"))var i=parseInt($(a).css("zIndex"));else var i=parseInt($(a).find(".wirejr").css("zIndex"));return t-i});var s=a.position(),n=parseInt(a.css("zIndex")),o=a.find("> div").position(),r=[];i.each(function(e){var a=$(this);a.is(".grouped")?a.css("z-index",n):a.find(".wirejr").css("z-index",n),r[e]=a.attr("id"),abspos={top:parseInt(a.css("top")),left:parseInt(a.css("left"))},a.css({top:s.top+(abspos.top+o.top),left:s.left+(abspos.left+o.left)})}),t=t.concat(r),i.removeClass("groupmember").appendTo(activepage),$("#group").removeClass("pressed"),a.remove()}),saveState("",t,null,null,a)}function sortdivs(e,a){for(var t=new Array,i=0;i<e.length;i++)pos=e.eq(i).position(),t.push("top"==a?{div:e.eq(i),val:pos.top}:{div:e.eq(i),val:pos.left});var s=t.sort(function(e,a){return e.val<a.val?-1:e.val>a.val?1:0});return s}function renderContextMenu(){$("#canvas").contextPopup({title:"",items:[{label:"Copy",action:function(){copynow()},"short":"Ctrl+C"},{label:"Cut",action:function(){cutnow()},"short":"Ctrl+X"},{label:"Paste",action:function(){paste()},"short":"Ctrl+V"},{label:"Delete",action:function(){delnow()},"short":"Del"},{label:"Edit",action:function(){$(".selected").dblclick()},"short":"doubleclick"},{label:"Bring to front",action:function(){bring_to_front()},"short":"Ctrl+Shift+↑"},{label:"Bring forward",action:function(){bring_forward()},"short":"Ctrl+↑"},{label:"Send to back",action:function(){send_to_back()},"short":"Ctrl+Shift+↓"},{label:"Send backward",action:function(){send_backward()},"short":"Ctrl+↓"},{label:"Lock / Unlock",action:function(){lock()},"short":"Ctrl+L"},{label:"Group / Ungroup",action:function(){group_ungroup()},"short":"Ctrl+G"},{label:"Link",action:function(){makeLink()},"short":"Ctrl+K"}]})}function add_new_page(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;e=escapeHtml(e);var a=$.now(),t=activepage.data("template");$("#canvas").append($("<div>").addClass("page").attr({id:a,"data-pagename":e,"data-page-height":$canvaswrap.height(),"data-page-width":$canvaswrap.width(),"data-template":t})),pagelist.append($("<li>").attr({"data-pageid":a}).text(e).click(function(){make_page_active($(this).attr("data-pageid"))})),make_page_active(a),$(".pagename-wrap").click()})}function make_page_active(e,a){var t=$("[data-pageid="+e+"]"),i=t.text();$canvas.find(".selected").removeClass("selected"),$(".pagename").text(i),activepage.hide();var s=activepage.data("template");activepage=$("#"+e),activepage.show().siblings(".page").hide(),$(".sitemap li").removeClass("activepage"),t.addClass("activepage"),previewMode?(0==$("#canvas .page:visible").next(".page").length?$("#next").addClass("inactive"):$("#next").removeClass("inactive"),0==$("#canvas .page:visible").prev(".page").length?$("#prev").addClass("inactive"):$("#prev").removeClass("inactive")):useboxer(),wirepanel.hide();var n=activepage.attr("data-page-width"),o=activepage.attr("data-page-height"),r=activepage.attr("data-template");s!==r&&$("[data-template-btn="+r+"]").insertBefore($("[data-template-btn]:first")),$canvaswrap.css({width:n+"px",height:o+"px"}).removeClass("mobile template browser-wrap mobile-landscape").addClass(r),$(".container").css({width:n+"px",height:parseInt(o,10)+250+"px"}),$("#canvas").show(),updateCanvasInput(n,o),$canvaswrap.center()}function makeLink(){if($(".page").length){var e=$("#linkselect");e.empty(),e.append($("<option>").append("None").attr("value",0)),$(".sitemap ul li").each(function(){e.append($("<option>").append($(this).text()).attr("value",$(this).attr("data-pageid")))});var a=$("#canvas .page:visible .selected").attr("data-link");a&&$("#linkselect option[value="+a+"]").attr("selected",!0),$("#linklist").show().siblings().hide(),positionwirepanel(),wirepanel.show(),e.change(function(){var e=$("#linkselect option:selected").attr("value");$("#canvas .page:visible .selected").attr("data-link",e).addClass("icon-link"),wirepanel.hide()})}else alert("You need to be a Premium user to make clickable wireframes.")}function preview(){previewMode=!previewMode,previewMode&&(activepage.find(".selected").removeClass("selected"),$("#top").addClass("topup"),supercanvas.removeClass("slide-left , slide-right , slide-down"),exportbtn.removeClass("pressed"),$(".bottomright, #wirepanel").hide(),$("#canvas .page .wire").draggable("destroy").resizable("destroy").removeClass("ui-resizable-autohide"),$("#canvas").addClass("preview"),$(".ui-boxer").boxer("destroy"),$("#canvas .page").bind("click",highlightclickable),$("#canvas .page .wire[data-link]").bind("click",gotopage))}function highlightclickable(){var e=$("#canvas .page:visible .wire[data-link]");e.stop(!0,!0).addClass("hilite").delay(600).queue(function(a){e.removeClass("hilite")})}function makeEditable(){$("#top").removeClass("topup"),$(".bottomright").show(),$("#canvas").removeClass("preview"),$(".wire[data-link]").unbind("click",gotopage),$("#canvas .page").unbind("click",highlightclickable),useboxer()}function saveComment(){$savecomment.show(),$savecomment.bind("click",function(){$("#canvas .page .publiccomment ,#canvas .page .aa").resizable("destroy").draggable("destroy");var e="";$("#canvas .page .publiccomment , #canvas .page .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),e+=$(this).outerHTML()});var a=encodeURIComponent(e);$.post("../savecomment",{pblcaa:a,preview:previewid},function(){$(".saved").show().delay(600).fadeOut(),$("#canvas .page .publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}}),$savecomment.unbind("click"),$savecomment.hide()})})}function positionAA(){$(".publiccomment , .aa").each(function(){$(this).appendTo($("#"+$(this).attr("data-parent")))}),$(".publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"all",stop:function(){saveComment()}})}function getMaxDim(){var e=$canvas.find(".page"),a=e.map(function(){return $(this).attr("data-page-width")}).get(),t=e.map(function(){return $(this).attr("data-page-height")}).get();return{width:Math.max.apply(Math,a),height:Math.max.apply(Math,t)}}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function demoStart(){fc.addClass("no-cursor"),c.show().transition({x:"0",y:"0"},0).transition({x:"-130px",y:"-68px"},1600).transition({x:"-130px",y:"-60px",easing:"snap",delay:200},150,demo1)}function demo1(){c.hide(),d1.addClass("draw").removeClass("bg-grey demo-box").css({width:0,height:0}).transition({width:"0",height:"0"},0).show().find(".cursor").show().end().transition({width:"260px",height:"160px",delay:100},2500,demo2)}function demo2(){d1.find(".cursor").hide(),wp.css({top:"-45px",left:"0px"}).show().find(".draw-icons").show().end().find(".edit-icons").hide(),c.show().transition({x:"128px",y:"98px"},0,demo3)}function demo3(){c.transition({x:"-120px",y:"-95px",delay:"600"},1600,demo4)}function demo4(){d1.removeClass("draw").addClass("demo-box"),c.transition({x:"-120px",y:"-91px"},100).transition({x:"-120px",y:"-95px"},100,demo5)}function demo5(){wp.hide(),c.transition({x:"-42px",y:"-35px",delay:"400"},1e3).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150,demo6)}function demo6(){wp.show().find(".draw-icons").hide().end().find(".edit-icons").show(),c.transition({x:"75px",y:"-95px"},1100).transition({x:"75px",y:"-90px"},100).transition({x:"75px",y:"-95px"},100,demo7)}function demo7(){d1.addClass("bg-grey"),window.setTimeout(demo8,800)}function demo8(){wp.hide(),fc.removeClass("no-cursor"),d1.hide(),dw.hide(),$("#feux-play").show()}$(function(){$canvas.offset();if($(".editable").editnibble("hideAllEditors"),$("#show-bg").hide(),$("#canvas .txtcont span:empty").length&&$(".txtcont span:empty").text(paragraphtext),$("#canvas .listcont:empty").length){var e=$(".listcont:empty");e.each(function(){var e=$(this).parent().attr("data-color");$(this).html(list).find("li span").css({"background-color":e})})}if(!$("#canvas #grid-div").length){$("#canvas").prepend($(".grids").show().contents().unwrap()),$("#show-grid").attr("checked",!0);var a=$canvaswrap.attr("data-grid");switch(a){case"graph":$("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("select#grid-type").val("graph");break;case"dots":$("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$("select#grid-type").val("dots");break;case"col":$("#gridcol").show(),$("#grid-div , #grid-dot").hide(),$("select#grid-type").val("col");break;default:$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1)}}imgs=$(".device-wrap span"),$("#canvas .wire").has(".headlinetxt").addClass("hastext"),$(".textnew.ui-draggable").draggable("destroy"),$canvaswrap.center(),$("#canvas .locked").draggable("destroy").resizable("destroy"),$("#sitemaplist").sortable({placeholder:"ui-state-highlight",containmentType:"div.sitemap",start:function(e,a){$(document).data("oldpos",a.item.index())},stop:function(e,a){var t=a.item.index(),i=a.item.attr("data-pageid");$(document).data("oldpos")>t?$("#canvas #"+i).insertBefore($("#canvas .page:eq("+t+")")):$(document).data("oldpos")<t&&$("#canvas #"+i).insertAfter($("#canvas .page:eq("+t+")"))}}).disableSelection("#sitemaplist li")}),$("#canvas .wire").not("#canvas .wire:has(.wirejr)").css({"border-style":"solid"});var multipaged;multipaged=$("#canvas .page").length?!0:!1;var supercanvas=$(".supercanvas"),exporting=$(".exporting"),gridsize=0,imgs,wirePresent=!0,wirepanel=$("#wirepanel"),annotPresent=!0,offset_c=$("#canvas").offset(),cwidth=$("#canvas-wrap").width(),MIN_DISTANCE=6,guides=[],innerOffsetX,innerOffsetY,offseta1=$("#canvas").offset(),defbw=1,defstrcolor="#444",defbgcolor="white",clonewidth=0,cloneheight=0,$canvaswrap=$("#canvas-wrap"),$canvas=$("#canvas"),index_highest=0,sttngs=$(".settings span i"),sett=$(".settings"),$sitemapicon=$("#sitemap icon i"),previewMode,$dim=$(".dim"),$edittxt=$("#edittxt");$(".container").hasClass("preview")&&(previewMode=!0),$(document).ready(function(){setgridsize(),$(document).keydown(function(e){var a=$(document.activeElement).hasClass("editingtext"),t=$(document.activeElement).hasClass("editor-form-element"),i=$(document.activeElement).hasClass("input"),s=$(".appriseInner").length,n=$ajaxlogin.is(":visible"),o=$("#canvas .selected").length;return 8!==e.keyCode||a||t||i||s||o?void(8!==e.keyCode||!o||a||i||t||s||n||(e.preventDefault(),$("#canvas .selected").remove())):!1}),updateCanvasInput(),previewMode||$(".aa").draggable().resizable({handles:"all"})}),positionAA(),$("#show-grid").bind("click",function(){$(this).is(":checked")?"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid","graph")):"dots"==$("select#grid-type").val()?($("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$canvaswrap.attr("data-grid","dots")):($("#gridcol").show(),$canvaswrap.attr("data-grid","col"),$("#grid-div , #grid-dot").hide()):($("#grid-div , #gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid",0))}),$("#gridcol").is(":visible")||$("#grid-div").is(":visible")||$("#show-grid").removeAttr("checked"),$("select#grid-type").change(function(){"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","graph")):"dots"==$("select#grid-type").val()?($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","dots")):($("#gridcol").show(),gridsize=0,$("#grid-div , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid","col"))}),$("#empty").click(function(){var e=confirm("Do you want to clear the canvas?");e===!0&&(window.location="/")});var imgs=$(".device-wrap span");$(".device-mobile").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile").removeClass("browser-wrap , mobile-landscape , tablet").center(),activepage.find(".wire").length||($canvaswrap.css({width:"320px",height:"480px"}).center(),activepage.attr({"data-page-width":"320","data-page-height":"480"})),activepage.attr("data-template","mobile"),offset_c=$("#canvas").offset(),updateCanvasInput(),imgs=$(".device-wrap span"))}),$(".device-tablet").click(function(){console.log(activepage),$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.addClass("mobile , tablet").removeClass("browser-wrap , mobile-landscape").center(),activepage.find(".wire").length||($canvaswrap.css({width:"728px",height:"1024px"}).center(),activepage.attr({"data-page-width":"728","data-page-height":"1024"}),supercanvas.css("height","1350px")),activepage.attr("data-template","mobile tablet"),$(".container").css("overflow-y","auto"),offset_c=$("#canvas").offset(),imgs=$(".device-wrap span"),updateCanvasInput())}),$(".device-window").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),$canvaswrap.removeClass("mobile , tablet , mobile-landscape").addClass("browser-wrap").center(),activepage.find(".wire").length||($canvaswrap.css({width:"820px",height:"480px"}).center(),activepage.attr({"data-page-width":"820","data-page-height":"480"})),activepage.attr("data-template","browser-wrap"),offset_c=$("#canvas").offset(),updateCanvasInput(),imgs=$(".device-wrap span"))}),$(".device-mobile-landscp").click(function(){$(this).is(":first-child")||($(this).insertBefore(imgs.eq(0)),activepage.attr("data-template","mobile-landscape"),$canvaswrap.addClass("mobile-landscape").removeClass("browser-wrap , mobile , tablet").center(),activepage.is(":empty")&&($canvaswrap.css({width:"480px",height:"320px"}).center(),activepage.attr({"data-page-width":"480","data-page-height":"320"})),offset_c=$("#canvas").offset(),updateCanvasInput(),imgs=$(".device-wrap span"))}),$("#show-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").show(),$("#hide-annotation").show(),$(this).hide()}),$("#hide-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").hide(),$("#show-annotation").show(),$(this).hide()}),$("#edit-wire").click(function(){$("#canvas .selected").dblclick()}),$("#lock").click(function(){lock()});var $ajaxlogin=$("#ajaxlogin"),supports_pushState="pushState"in history;if($("#save").click(function(){$("#canvas .page:visible .selected").removeClass("selected"),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=supercanvas.clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),a=encodeURIComponent(e),t="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),t+=$(this).outerHTML()});var i=encodeURIComponent(t);$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:i},success:function(s){switch(s){case"login":localStorage.setItem(filename,e),localStorage.setItem(filename+"aa",t),$ajaxlogin.find(".wrongpass").hide(),$ajaxlogin.show().submit(function(e){e.preventDefault(),$.ajax({type:"POST",url:"../ps/ajaxlogin.php",data:$ajaxlogin.serialize(),success:function(e){0==e?$ajaxlogin.find(".wrongpass").show():$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:i},success:function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa"),$ajaxlogin.hide(),_paq.push(["trackGoal",3])}})}})}),_paq.push(["trackGoal",2]);break;default:$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa")}},error:function(){localStorage.setItem(filename,e),localStorage.setItem(filename+"aa",t),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"}),_paq.push(["trackGoal",1])}})}),$("#fork").click(function(){$("#canvas .page:visible .selected").removeClass("selected"),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),a=encodeURIComponent(e),t="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),t+=$(this).outerHTML()});var i=encodeURIComponent(t),s=$.now();$.post("../fork",{note:a,name:filename,aa:i,timestamp:s},function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"all"})})}),$("#savefree").click(function(){var e=!0;$("#canvas .selected").removeClass("selected"),$("#canvas .wire , #canvas .aa ").draggable("destroy").resizable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var a=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().htmlClean().html(),t=encodeURIComponent(a);0===filename?filename=randomID(6):e=!1,supports_pushState?history.pushState({},"filename","/"+filename):location.hash="#"+filename,$.post("save.php",{note:t,name:filename},function(){MakeCanvasDrag(),e?($(".savedURL").html("http://wireframe.cc/"+filename),$(".save-wrap").fadeIn().delay(1600).fadeOut()):$(".saved").fadeIn().delay(600).fadeOut(),makeDrag($("#canvas .aa"))})}),$(".closeannot , .closeURLpopup").click(function(){var e=$(this).parent();e.remove(),previewMode&&saveComment()}),$(".ok").click(editableTextBlurred),$canvas.bind("editThisText",".textme",edittext),$.widget("ui.boxer",$.extend({},$.ui.mouse,{_init:function(){this.element.addClass("ui-boxer"),this.dragged=!1,this._mouseInit(),this.helper=$(document.createElement("div")).css({background:"rgba(0,0,0,0.7)"}).addClass("ui-boxer-helper"),$dim.html("<b>W</b>: 0px, <b>H</b>: 0px")},destroy:function(){return this.element.removeClass("ui-boxer ui-boxer-disabled").removeData("boxer").unbind(".boxer"),this._mouseDestroy(),this},_mouseStart:function(e){wirepanel.hide(),(supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")||supercanvas.hasClass("slide-down"))&&(supercanvas.removeClass("slide-left , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed")),1==$("#show-grid").attr("checked")&&"col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked")&&(guides=$.map($(".col"),computeColForElement)),e.ctrlKey||e.shiftKey||e.metaKey||$("#canvas .selected").removeClass("selected"),$("#canvas .latestwire").removeClass("latestwire"),$("#lock , #group").removeClass("pressed"),$(".blank").remove();if(this.opos=[e.pageX,e.pageY],!this.options.disabled){var a=this.options;this._trigger("start",e),$(a.appendTo).append(this.helper),this.helper.css({"z-index":1e3,position:"absolute",left:e.clientX,top:e.clientY,width:0,height:0})}},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var a=(this.options,this.opos[0]),t=this.opos[1],i=e.pageX,s=e.pageY;if(a>i&&t>s&&this.helper.addClass("selecting"),a>i){var n=i;i=a,a=n}if(t>s){var o=s;s=t,t=o}if(this.helper.css({left:a,top:t,width:i-a,height:s-t}),!this.helper.hasClass("selecting")){var r=.1+(i-a)/cwidth;r>=.7&&(r=.7),this.helper.css({left:a,top:t,width:i-a,height:s-t}).css({background:"rgba(0,0,0,"+r+") url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIUlEQVQYV2NkYGCQBGJ08BxdgHGIKMTiF0wPgjwz2BUCADTeBYguWvyCAAAAAElFTkSuQmCC)"})}return $dim.html("<b>W</b>: "+parseInt(i-a-1,10)+"px, <b>H</b>: "+parseInt(s-t-1,10)+"px"),this._trigger("drag",e),!1}},_mouseStop:function(e){function a(e,a){for(var t=a[0],i=Math.abs(e-t),s=0;s<a.length;s++){var n=Math.abs(e-a[s]);i>n&&(i=n,t=a[s])}return t}$(".dimnow").remove();this.dragged=!1;var t=(this.options,this.opos[0]),i=this.opos[1],s=e.pageX,n=e.pageY,o=$("#canvas").offset();activepage.find("> .wire > .wirejr, .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);e>index_highest&&(index_highest=e)});var r=t-o.left,d=i-o.top;if(clonewidth=s-t,cloneheight=n-i,0>r&&(r=0),0>d&&(d=0),clonewidth>cwidth&&(clonewidth=cwidth),gridsize>0){r=Math.round(r/gridsize)*gridsize,d=Math.round(d/gridsize)*gridsize,clonewidth=Math.round(clonewidth/gridsize)*gridsize,cloneheight=Math.round(cloneheight/gridsize)*gridsize;var l=this.helper.clone().css({left:r,top:d,"z-index":index_highest+1,width:clonewidth,height:cloneheight}).removeClass("ui-boxer-helper").appendTo(activepage).addClass("brandnew blank");$dim.html(r>20?"<b>W</b>: "+clonewidth+"px, <b>H</b>: "+cloneheight+"px":"<b>W</b>: 0px, <b>H</b>: 0px")}else if("col"==$("select#grid-type").val()&&1==$("#snap-to-grid").attr("checked"))if(clonewidth>20||cloneheight>20){guides1=[],guides2=[];for(var c=0;c<guides.length;c+=2)guides1.push(guides[c]);for(var c=1;c<guides.length;c+=2)guides2.push(guides[c]);r=a(r,guides1),clonewidth=a(s-o.left,guides2)-r;var l=this.helper.clone().css({left:r,top:d,"z-index":index_highest+1,width:clonewidth,height:cloneheight}).removeClass("ui-boxer-helper").appendTo(activepage).addClass("brandnew blank");$dim.html(clonewidth>20||cloneheight>20?"<b>W</b>: "+clonewidth+"px, <b>H</b>: "+cloneheight+"px":"<b>W</b>: 0px, <b>H</b>: 0px")}else this.helper.remove();else{var p=0;$canvaswrap.hasClass("browser-wrap")||(p=1);var l=this.helper.clone().css({left:r-p,top:d-p,width:clonewidth,"z-index":index_highest+1}).removeClass("ui-boxer-helper").appendTo(activepage).addClass("brandnew blank");$dim.html(s-t>20?"<b>W</b>: "+(s-t-1)+"px, <b>H</b>: "+(n-i-1)+"px":"<b>W</b>: 0px, <b>H</b>: 0px")}return this._trigger("stop",e,{box:l}),this.helper.removeClass("selecting").css("background","transparent").remove(),!1}})),$.extend($.ui.boxer,{defaults:$.extend({},$.ui.mouse.defaults,{appendTo:"body",distance:0})}),$(".page").length)var activepage=$(".page:visible");else var activepage=$("#canvas");previewMode||useboxer(),wirepanel.delegate(".icon","hover",function(){var e=$(this);$canvas.find(".brandnew").length&&(type=e.attr("elementtype"),prepareWire())}),wirepanel.delegate(".icon","click",function(){insertWire()});var type;$canvas.delegate(".wire","mouseenter",function(){var e=$(this);if(e.is(":data(draggable)")||e.is(".multidrag")||previewMode||makeDrag(e),e.is(":data(draggable)")){isover=!0;var a=!1;$(document).bind("keydown",function(t){a||(a=!0,t.shiftKey&&1==isover&&e.draggable("disable"))})}}).delegate(".wire","mouseleave",function(e){isover=!1,$(document).unbind("keydown");var a=$(this);a.hasClass("ui-draggable-disabled")&&a.draggable("enable")}).delegate(".wire","contextmenu",function(e){var a=activepage.find(".selected");1===a.length&&a.removeClass("selected"),$(this).addClass("selected")}),$canvas.bind("mousedown",".wire",function(e){if(1==e.altKey){activepage.data("altdrag",!0);var a=activepage.find(".selected");if(1==a.length){var t=a.draggable("option","helper");a.draggable("option","helper","clone").removeClass("selected").addClass("altdrag")}t&&$canvas.droppable({drop:function(e,i){var s=$(i.helper).clone().removeClass("ui-draggable-dragging, ui-resizable");s.appendTo(activepage).addClass("selected").removeClass("altdrag").find(".ui-resizable-handle").remove();var n=[];s.each(function(e){var a="w"+(new Date).getTime()+e;$(this).draggable("destroy").resizable("destroy").attr("id",a),n[e]=a}),historystate.shift(),saveState("",n),makeDrag(s),$canvas.droppable("destroy"),a.draggable("option","helper",t),activepage.data("altdrag",!1)}})}});var isover=!1;MakeCanvasDrag(),$("#del").click(function(){delnow()}),$("#edit").click(function(){$("#icons").show().siblings().hide(),$('.icon[elementtype="headlinetxt"]').hide(),positionwirepanel()}),$edittxt.click(function(){$canvas.find(".selected div.textme").trigger("editThisText"),wirepanel.hide()});var copied;posTopArray=[],posLeftArray=[],$("#copy").click(function(){copynow()}),$("#cut").click(function(){cutnow()}),key("ctrl+c, command+c",function(){copynow()}),key("ctrl+x, command+x",function(){cutnow()}),key("del",function(){delnow()}),key("backspace",function(e){e.preventDefault();var a=$(document.activeElement).hasClass("editingtext"),t=$(document.activeElement).hasClass("editor-form-element"),i=$(document.activeElement).hasClass("input"),s=$(".appriseInner").length,n=$ajaxlogin.is(":visible"),o=$canvas.find(".selected").length;return a||t||i||s||o?void(!o||a||i||t||s||n||(e.preventDefault(),delnow())):!1}),$("#paste").click(function(){paste()}),key("ctrl+v, command+v",function(){paste()});var pasteIndex=1;$(".colorpicker").click(function(){var e=$(this).css("background-color");changeBackgroundColor(e)}),$(".strokeweight").click(function(){changeBorderWidth($(this).attr("stroke"))}),$.fn.getId=function(){if($(this).attr("id"))return $(this).attr("id");var e="w"+(new Date).getTime();return $(this).attr("id",e),e},$(".brcolor").click(function(){if(saveState(),$(".selected").has(".wirejr").length)var e=activepage.find(".selected").not(".locked").find(".wirejr");else var e=$canvas.find(".selected").not(".locked");current_brcolor=$(this).css("border-left-color"),e.css("border-color",current_brcolor),e.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),e.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor)}),$("#front").click(function(){bring_to_front()}),$("#back").click(function(){send_to_back()}),$("#backward").click(function(){send_backward()}),$("#forward").click(function(){bring_forward()});var $showbg=$(" #show-bg"),$strokes=$("#strokes"),$showborderbg=$("#show-border , #show-bg"),$colorpickers=$("#colorpickers"),$bordercolors=$("#bordercolors"),$edittxt=$("#edittxt"),$textalsz=$("#textalign , #textsize");$("#show-bg").click(function(){$("#colorpickers").show(),$("#bordercolors").hide(),$("#show-border").show(),$("#show-bg").hide()}),$("#show-border").click(function(){$("#bordercolors").show(),$("#colorpickers").hide(),$("#show-border").hide(),$("#show-bg").show()}),$("#alignleft").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","left")}),$("#aligncenter").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","center")}),$("#alignright").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","right")}),$("#alignjustify").click(function(){saveState(),$("#canvas .selected").find("span").css("text-align","justify")}),$("#font-s").click(function(){if(saveState(),$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"7px","line-height":"13px"}),$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"7px","line-height":"13px"}),$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"12px","line-height":"12px"}),$canvas.find(".selected .textnew").length){var e=$canvas.find(".selected .textnew");e.css({"font-size":"12px"}),e.parent().css("height",e.height())}$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span ").css({"font-size":"14px","line-height":"14px","margin-bottom":"2px"})}),$("#font-m").click(function(){if(saveState(),$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"10px","line-height":"20px"}),$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"10px","line-height":"20px"}),$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"18px","line-height":"18px"}),$canvas.find(".selected .textnew").length){var e=$canvas.find(".selected .textnew");e.css({"font-size":"18px"}),e.parent().css("height",e.height())}$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span").css({"font-size":"22px","line-height":"22px","margin-bottom":"6px"})}),$("#font-l").click(function(){if(saveState(),$("#canvas .selected.paragraph span , #canvas .selected .paragraph span").css({"font-size":"18px","line-height":"36px"}),$("#canvas .selected.list span ul li span , #canvas .selected .list span ul li span").css({"font-size":"18px","line-height":"36px"}),$("#canvas .selected.headlinetxt .editable .content-wrapper").css({"font-size":"28px","line-height":"28px"}),$canvas.find(".selected .textnew").length){var e=$canvas.find(".selected .textnew");e.css({"font-size":"28px"}),e.parent().css("height",e.height())}$("#canvas .selected.headline , #canvas .selected .headline").find(".headtext span ").css({"font-size":"28px","line-height":"28px","margin-bottom":"8px"})}),jQuery.fn.center=function(e){e=e?this.parent():window;var a=($(e).width()-this.outerWidth())/2+$(e).scrollLeft();

return 0>a&&(a=10),this.css({left:a+"px","margin-left":"0",top:"120px"}),this};var annotationhtml="<span class=annotbox><div class='editme thelatest'></div><button class=ok><i class=icon-ok></i> ok</button></span><div class=closeannot><i class=icon-remove></i></div>",texthtml="<span class='text'><div class='textme thelatest'></div></span>",paragraph="<span class=txtcont><span>Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iise mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.</span></span>",paragraphtext="Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.",list="<span class='listcont'><ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul></span>",listhtml="<ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul>",headtxt="<span class='headtext'><span>Lorem</span> <span>ipsum</span> <span>dolor</span> <span>sitammet</span> <span>quam</span> <span>Lorem</span> <span>ipsumdolor</span> <span>sitammet</span> <span>quam</span></span>",img="<svg id='imgwire' version='1.1' baseProfile='tiny'  xmlns='http://www.w3.org/2000/svg'  width='200px' height='100px' viewBox='0 0 200 100' preserveAspectRatio='none'><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='100' x2='200' y2='0'/><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='0' x2='200' y2='100'/></svg>";$("#watch-demo").click(function(){$(".panel").is(":visible")||demo0()}),previewMode?$("#canvas .publiccomment .annotbox div").click(divClicked):$("#canvas .annotbox div").click(divClicked),$canvas.find(".aa").length&&$("#hide-annotation").show(),$canvas.find(".aa:hidden").length&&($("#hide-annotation").hide(),$("#show-annotation").show());var delay=function(){var e=0;return function(a,t){clearTimeout(e),e=setTimeout(a,t)}}();$(window).resize(function(){delay(function(){$canvaswrap.center()},500)}),$("#grid-slider").slider({min:10,max:50,value:20,slide:function(e,a){$(".grid-size-val").text(a.value)},stop:function(e,a){updategrid(a.value),turngridon()}}),$("#snap-to-grid , #grid-type").change(function(){turngridon(),$("#snap-to-grid").attr("checked")||($canvaswrap.attr("snappy",0),gridsize=0)}),$canvaswrap.data("savedState",[]),$canvaswrap.data("savedUndo",[]);var historystate=$canvaswrap.data("savedState"),future=$canvaswrap.data("savedUndo");key("ctrl+z, command+z",function(e){e.preventDefault(),restoreState(!0)}),$("#undo").click(function(){restoreState(!0)}),key("ctrl+y, command+y, command+shift+z",function(e){e.preventDefault(),restoreState(!1)}),$("#redo").click(function(){restoreState(!1)}),$("#canvas").mousemove(function(e){$(".coord").html("<b>X</b>: "+parseInt(e.pageX-offset_c.left,10)+" <b>Y</b>: "+parseInt(e.pageY-offset_c.top,10))}),sett.bind("click",function(e){wirepanel.hide(),supercanvas.hasClass("slide-down")?supercanvas.removeClass("slide-down").delay(600).queue(function(e){sharebar.hide(),sett.toggleClass("pressed"),exportbtn.removeClass("pressed"),supercanvas.toggleClass("slide-left"),e()}):(sharebar.hide(),exportbtn.removeClass("pressed"),supercanvas.removeClass("slide-right , slide-down"),supercanvas.toggleClass("slide-left"),$(this).toggleClass("pressed "),$(this).find("i").toggleClass("icon-arrow-right"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"))}),$("select#def-stroke-width").change(function(e){defbw=$("select#def-stroke-width").val()}),$("select#def-stroke-color").change(function(e){defstrcolor=$("select#def-stroke-color").val()}),$("select#def-bg-color").change(function(e){defbgcolor=$("select#def-bg-color").val()}),$("#canvas_w_val").change(function(){var e=parseInt($(this).val(),10);$canvaswrap.width(e),activepage.attr("data-page-width",e),updateCanvasInput(),$canvaswrap.center()}),$("#canvas_h_val").change(function(){var e=parseInt($(this).val(),10);$canvaswrap.css("height",e+"px"),activepage.attr("data-page-height",e),updateCanvasInput()}),key("down",function(e){handleKeys(e)}),key("up",function(e){handleKeys(e)}),key("left",function(e){handleKeys(e)}),key("right",function(e){handleKeys(e)}),$("#group").click(function(){group_ungroup()}),key("ctrl+g, command+g",function(e){if(e.preventDefault(),multipaged)var a=activepage.find(".selected").not(".locked");else var a=$canvas.find(".selected").not(".locked");group_elements(a)}),key("ctrl+shift+g, command+shift+g",function(e){e.preventDefault(),ungroup_elements($("#canvas .selected.grouped"))}),$("#align-top").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length)e.css("top","1px");else{var a=1e4;e.each(function(){var e=$(this).position();a=a<e.top?a:e.top}),e.css("top",a+"px")}}),$("#align-left").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length)e.css("left","1px");else{var a=1e4;e.each(function(){var e=$(this).position();a=a<e.left?a:e.left}),e.css("left",a+"px")}}),$("#align-right").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var a=$("#canvas").width(),t=e.width(),i=parseInt(e.css("borderWidth"),10);e.css("left",a-t-2*i+1+"px")}else{var s=-1;e.each(function(){var e=$(this).position(),a=$(this).width();s=s>e.left+a?s:e.left+a}),e.each(function(){var e=$(this).width();$(this).css("left",s-e+"px")})}}),$("#align-bottom").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var a=$("#canvas").height(),t=e.height(),i=parseInt(e.css("borderWidth"),10);e.css("top",a-t-2*i+1+"px")}else{var s=-1;e.each(function(){var e=$(this).position(),a=$(this).height();s=s>e.top+a?s:e.top+a}),e.each(function(){var e=$(this).height();$(this).css("top",s-e+"px")})}}),$("#align-center").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var a=$("#canvas").height(),t=e.height();e.css("top",a/2-t/2+"px")}else{var i=-1,s=1e3;e.each(function(){var e=$(this).position(),a=$(this).height();i=i>e.top+a?i:e.top+a,s=s<e.top?s:e.top}),e.each(function(){var e=$(this).height();$(this).css("top",(i+s)/2-e/2+"px")})}}),$("#align-middle").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");if(saveState(e),1==e.length){var a=$("#canvas").width(),t=e.width();e.css("left",a/2-t/2+"px")}else{var i=-1,s=1e3;e.each(function(){var e=$(this).position(),a=$(this).width();i=i>e.left+a?i:e.left+a,s=s<e.left?s:e.left}),e.each(function(){var e=$(this).width();$(this).css("left",(i+s)/2-e/2+"px")})}}),$("#dist-v").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");saveState(e);var a=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"top"),maxTop=distrb[0].val+distrb[0].div.height()/2,last=distrb.length-1,maxBottom=distrb[last].val+distrb[last].div.height()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.height();thisdiv.css("top",maxTop+(maxBottom-maxTop)/divide*a-e/2+"px"),a++})}),$("#dist-h").click(function(){if(multipaged)var e=activepage.find(".selected").not(".locked");else var e=$canvas.find(".selected").not(".locked");saveState(e);var a=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"left"),maxLeft=distrb[0].val+distrb[0].div.width()/2,last=distrb.length-1,maxRight=distrb[last].val+distrb[last].div.width()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.width();thisdiv.css("left",maxLeft+(maxRight-maxLeft)/divide*a-e/2+"px"),a++})}),$("#align").click(function(){$(".align-icons").toggleClass("align-icons-visible"),$("#arrange-icons").hasClass("arrange-icons-visible")||$(".align-icons").siblings().toggleClass("inactive"),$(this).toggleClass("pressed"),$("#arrange-icons").hasClass("arrange-icons-visible")&&($("#arrange-icons").removeClass("arrange-icons-visible"),$("#arrange").removeClass("pressed"))}),$("#arrange").click(function(){$("#arrange-icons").toggleClass("arrange-icons-visible"),$(".align-icons").hasClass("align-icons-visible")||$("#arrange-icons").siblings().toggleClass("inactive"),$(this).toggleClass("pressed"),$(".align-icons").hasClass("align-icons-visible")&&($(".align-icons").removeClass("align-icons-visible"),$("#align").removeClass("pressed"))}),$(".inner-btn , #align , #arrange , .pagename-wrap , .appriseInner").click(function(e){e.stopPropagation()}),key("b",function(){type="box",prepareWire(),insertWire()}),key("r",function(){type="roundbox",prepareWire(),insertWire()}),key("e",function(){type="elipse",prepareWire(),insertWire()}),key("i",function(){type="image",prepareWire(),insertWire()}),key("p",function(){type="paragraph",prepareWire(),insertWire()}),key("l",function(){type="list",prepareWire(),insertWire()}),key("h",function(){type="headline",prepareWire(),insertWire()}),key("t",function(e){e.preventDefault(),type="headlinetxt",prepareWire(),insertWire()}),key("a",function(e){e.preventDefault(),type="annotate",prepareWire(),insertWire()}),key("g",function(e){e.preventDefault(),type="line_hor",prepareWire(),insertWire()}),key("v",function(e){e.preventDefault(),type="line_vert",prepareWire(),insertWire()}),key("s",function(e){e.preventDefault(),type="slider",prepareWire(),insertWire()}),key("u",function(e){e.preventDefault(),type="progressbar",prepareWire(),insertWire()}),key("c",function(e){e.preventDefault(),type="combobox",prepareWire(),insertWire()}),key("q",function(e){e.preventDefault(),type="scrollh",prepareWire(),insertWire()}),key("y",function(e){e.preventDefault(),type="scrollv",prepareWire(),insertWire()}),key("n",function(e){e.preventDefault(),type="textinput",prepareWire(),insertWire()}),key("6",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#111","border-color":"#111"})),$("#canvas .selected").length&&changeBackgroundColor("#111")}),key("5",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#444","border-color":"#444"})),$("#canvas .selected").length&&changeBackgroundColor("#444")}),key("4",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#777","border-color":"#777"})),$("#canvas .selected").length&&changeBackgroundColor("#777")}),key("3",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#aaa","border-color":"#aaa"})),$("#canvas .selected").length&&changeBackgroundColor("#aaa")}),key("2",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#ddd","border-color":"#ddd"})),$("#canvas .selected").length&&changeBackgroundColor("#ddd")}),key("1",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"#fff","border-color":"#fff"})),$("#canvas .selected").length&&changeBackgroundColor("#fff")}),key("7",function(){$("#canvas .brandnew").length&&(type="box",prepareWire(),insertWire(),$("#canvas .latestwire").css({background:"tomato","border-color":"tomato"})),$("#canvas .selected").length&&changeBackgroundColor("tomato")}),key("0",function(){$("#canvas .selected").length&&changeBackgroundColor("transarent")}),key("alt+7",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("tomato"))}),key("alt+1",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("white"))}),key("alt+2",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#ddd"))}),key("alt+3",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#aaa"))}),key("alt+4",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#777"))}),key("alt+5",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#444"))}),key("alt+6",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("#111"))}),key("alt+0",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderColor("transparent"))}),key("ctrl+1",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderWidth("1"))}),key("ctrl+2",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderWidth("2"))}),key("ctrl+3",function(e){$("#canvas .selected").length&&(e.preventDefault(),changeBorderWidth("4"))}),key("ctrl+a, command+a",function(e){e.preventDefault(),multipaged?$(".page:visible .wire").not(".locked , .groupmember").addClass("selected"):$(".wire").not(".locked , .groupmember").addClass("selected")}),key("esc",function(e){e.preventDefault(),$(".selected").removeClass("selected")}),$(".container").hasClass("preview")||renderContextMenu(),key("ctrl+up, command+up",function(e){e.preventDefault(),bring_forward()}),key("ctrl+shift+up, command+shift+up",function(e){e.preventDefault(),bring_to_front()}),key("ctrl+shift+down, command+shift+down",function(e){e.preventDefault(),send_to_back()}),key("ctrl+down, command+down",function(e){e.preventDefault(),send_backward()}),key("ctrl+l, command+l",function(e){e.preventDefault(),lock()}),key("ctrl+k, command+k",function(e){e.preventDefault(),makeLink()});var pagelist=$(".sitemap ul");multipaged&&(pagelist.empty(),$(".page").each(function(){pagelist.append($("<li>").attr({"data-pageid":$(this).attr("id")}).append($(this).attr("data-pagename")).click(function(){make_page_active($(this).attr("data-pageid"))}))})),$(".addpage").click(add_new_page),$(".sitemap li").click(function(){}),$(".pagename-wrap").click(function(){wirepanel.hide(),supercanvas.hasClass("slide-down")?supercanvas.removeClass("slide-down").delay(600).queue(function(e){sharebar.hide(),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),exportbtn.removeClass("pressed"),supercanvas.toggleClass("slide-right"),e()}):(supercanvas.removeClass("slide-left , slide-down"),sett.removeClass("pressed"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sharebar.hide(),supercanvas.toggleClass("slide-right"),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"))}),$("#delete-page").click(function(){$(".sitemap li").length>1?apprise("Are you sure?",{verify:!0},function(e){if(!e)return!1;var a=$(".sitemap .activepage").attr("data-pageid");$(".sitemap .activepage , #"+a).remove();var t=$(".sitemap li").eq(0).attr("data-pageid");make_page_active(t)}):apprise("You can't delete the only page in the project")}),$("#duplicate-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;e=escapeHtml(e),$canvas.find(".selected").removeClass("selected");var a=activepage.data("template"),t=$.now(),i=$(".sitemap .activepage").attr("data-pageid"),s=$("#"+i);$("#canvas").append($("<div>").addClass("page").attr({id:t,"data-pagename":e,"data-template":a}));var n=s.clone(!0,!0);n.find(".wire").find(".ui-resizable-handle").remove(),$.each(n.find(".wire"),function(e){var a="w"+$.now()+e;$(this).attr("id",a)});var o={width:s.data("page-width"),height:s.data("page-height")};$("#"+t).append(n.html()).attr({"data-page-width":o.width,"data-page-height":o.height}),$("#"+t+" .closeannot").click(function(){var e=$(this).parent();e.remove()}),pagelist.append($("<li>").attr({"data-pageid":t}).text(e).click(function(){make_page_active($(this).attr("data-pageid"))})),make_page_active(t,e)})}),function(){$canvas.find(".wire").each(function(e){$('[id="'+this.id+'"]').length>1&&$('[id="'+this.id+'"]').not($(this)).each(function(e){this.id+=e})})}(),$("#rename-page").click(function(){apprise("Enter new name",{verify:!0,input:!0},function(e){if(!e)return!1;e=escapeHtml(e);var a=$(".sitemap .activepage"),t=a.attr("data-pageid");$("#"+t).attr({"data-pagename":e}),a.text(e),make_page_active(t,e)})}),$("#Link").click(function(){makeLink()}),$("#preview").click(function(){preview()}),$("#re-edit").click(function(){previewMode=!1,makeEditable(),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap")}),$(".linkmark").click(function(e){e.stopPropagation(),$("#Link").click()});var gotopage=function(e){e.stopPropagation();var a=$(this).attr("data-link");0!=a&&make_page_active(a)};$("#export-btn").click(function(){$canvas.find(".wire,.aa").draggable("destroy").resizable("destroy");var e=$("#include-frame").is(":checked"),a=$("#export-scale").val();if($canvaswrap.resizable("destroy"),Boolean(parseInt($("#export-all-pages").val())))var t=$canvaswrap;else var t=$canvaswrap.clone().find("#"+activepage.attr("id")).siblings().remove().end().end();var i=t.outerHTML(),s=encodeURIComponent(i);exporting.show(),$.post("../export_png_pdf.php",{data:s,id:filename,extension:$("#export-format input[type='radio']:checked").val(),name:$("title").text(),frame:e,resolution:a},function(e){$("iframe").attr("src","../download-png-pdf.php?f="+e),MakeCanvasDrag(),exporting.hide()})});var sharebar=$(".sharebar"),exportbtn=$(".export");exportbtn.click(function(){exportbtn.toggleClass("pressed"),window.scrollTo(0,0),supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")?supercanvas.removeClass("slide-left , slide-right").delay(600).queue(function(e){sharebar.show(),$(this).toggleClass("slide-down"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),e()}):(sharebar.show(),supercanvas.toggleClass("slide-down"))}),previewMode&&$(".ui-boxer").boxer("destroy"),0==$("#canvas .page:visible").next(".page").length&&$("#next").addClass("inactive"),0==$("#canvas .page:visible").prev(".page").length&&$("#prev").addClass("inactive"),$("#next").click(function(){$("#prev").removeClass("inactive");var e=$(".page:visible"),a=e.next(".page").length;a&&(make_page_active(e.next(".page").attr("id")),0==$("#canvas .page:visible").next(".page").length&&$(this).addClass("inactive"))}),$("#prev").click(function(){$("#next").removeClass("inactive");var e=$(".page:visible"),a=e.prev(".page").length;a&&(make_page_active(e.prev(".page").attr("id")),0==$("#canvas .page:visible").prev(".page").length&&$(this).addClass("inactive"))}),$(".addComment").click(function(){$("#canvas .page:visible").append($("<div class='publiccomment'/>").css({width:"160px",height:"120px",top:"40px",left:"60px","z-index":5e3,position:"absolute"}).append(annotationhtml)),$(".editme").click(divClicked),$("#canvas .thelatest").click(),$("#canvas .closeannot").click(function(){var e=$(this).parent();e.remove(),saveComment()})});var $savecomment=$(".saveComment");$(document).keyup(function(e){27==e.keyCode&&(wirepanel.hide(),$(".blank").remove())}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},window._link_was_clicked=!1,window.onbeforeunload=function(e){return window._link_was_clicked?void 0:$("#canvas .wire").length&&"example"!=filename&&"examplemobile"!=filename?"Are you sure?":void 0},jQuery(document).bind("click","a",function(e){window._link_was_clicked=!0}),$.fn.hasAttr=function(e){return void 0!==this.attr(e)},jQuery.fn.htmlClean=function(){return this.contents().filter(function(){return 3!=this.nodeType?($(this).htmlClean(),!1):(this.textContent=$.trim(this.textContent),!/\S/.test(this.nodeValue))}).remove(),this},$canvas.delegate(".grouped:not(.groupmember)","click",function(e){previewMode||(e.ctrlKey||e.shiftKey||e.metaKey||$canvas.find(".selected").removeClass("selected"),$(e.target).closest(".grouped").toggleClass("selected"))}),$(".grouped:empty").remove(),multipaged&&$("#canvas").boxer("destroy"),function(){if(!multipaged){var e=$canvas.height();return e>600&&$(".container").css({"overflow-y":"auto"}),!1}var a=$canvas.find(".page:visible"),t=$canvaswrap.height(),i=$canvaswrap.width(),s="browser-wrap";$canvaswrap.hasClass("mobile")&&!$canvaswrap.hasClass("tablet")&&(s="mobile"),$canvaswrap.hasClass("mobile-landscape")&&(s="mobile-landscape"),$canvaswrap.hasClass("tablet")&&(s="mobile tablet"),$canvas.find(".page").show().each(function(e){var a=$(this);a.attr("data-page-width")||a.attr({"data-page-width":i,"data-page-height":t}),a.attr("data-template")||a.attr("data-template",s),a.css({height:"100%",width:"100%"});var n=a.find(".wire"),o=n.not(".groupmember").map(function(){return $(this).position().top+$(this).height()}).get(),r=n.not(".groupmember").not(".hastext").not(":has(.list), :has(.paragraph)").map(function(){return $(this).position().left+$(this).width()}).get(),d=Math.max.apply(Math,o),l=Math.max.apply(Math,r),c=parseInt(a.attr("data-page-height"),10),p=parseInt(a.attr("data-page-width"),10);d>c&&a.attr("data-page-height",d),l>p&&a.attr("data-page-width",l),c-d>30&&d>800&&previewMode&&a.attr("data-page-height",d)}).hide(),make_page_active(a.attr("id"));var n=a.data("template");"browser-wrap"!==n&&$("[data-template-btn="+n+"]").insertBefore($("[data-template-btn]:first"))}(),key("ctrl+s, command+s",function(e){previewMode||(e.preventDefault(),$("#save").click())}),previewMode&&supercanvas.bind("click",function(){(supercanvas.hasClass("slide-left")||supercanvas.hasClass("slide-right")||supercanvas.hasClass("slide-down"))&&(supercanvas.removeClass("slide-left , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"))}),$canvas.find(".multidrag").removeClass("multidrag");var $copyBtn=$("#copy-preview-link span"),clipboard=new Clipboard("#copy-preview-link");clipboard.on("success",function(e){$copyBtn.addClass("icon-ok").delay(600).queue(function(){$(this).removeClass("icon-ok").clearQueue()}),e.clearSelection()}),clipboard.on("error",function(e){}),navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)&&$copyBtn.parent().remove(),$(".closeabout, #about-wrap").click(function(){$("body").removeClass("show-about"),localStorage.setItem("about-closed",!0)}),$("#about-wrap").children().click(function(e){e.stopPropagation()}),$("#about-btn").click(function(e){e.preventDefault(),$("body").addClass("show-about"),wirepanel.hide()}),$.support.transition||($.fn.transition=$.fn.animate);var d1=$("#d1"),dw=$(".demowrap"),c=$("#cursor"),wp=$(".feux-wirepanel"),fc=$(".feux-canvas");$("#feux-play").bind("click",function(){$(this).hide(),dw.show(),localStorage.setItem("demo-watched",!0),demoStart()});